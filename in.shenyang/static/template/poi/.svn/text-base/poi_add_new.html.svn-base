<div class="pageContent" id="{$page_id}">
    <form method="post" action="{echo str_replace('/fresh_type/get', '', $current_url)}" class="pageForm required-validate" onsubmit="return validateCallback(this, navTabAjaxDone);">
        <div class="pageFormContent nowrap" layoutH="57">
            <table width="100%">
                <tr>
                    <td valign="top">
                    <dl>
                        <dt>
                            地点名称：
                        </dt>
                        <dd>
                            <input type="text" size="30" name="placename" id="placename" class="required" value="{$poi['placename']}" />
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            地址：
                        </dt>
                        <dd>
                            <input type="text" size="60" name="address" id="address" class="required" value="{$poi['address']}" />
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            纬度：
                        </dt>
                        <dd>
                            <input type="text" size="15" name="latitude" id="latitude" class="required" value="<!--{if $poi['latitude']}-->{$poi['latitude']}<!--{else}-->41.796767<!--{/if}-->" />
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            经度：
                        </dt>
                        <dd>
                            <input type="text" size="15" name="longitude" id="longitude" class="required" value="<!--{if $poi['longitude']}-->{$poi['longitude']}<!--{else}-->123.429096<!--{/if}-->" />
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            分类：
                        </dt>
                        <dd>
                            <input type="text" size="80" name="placeCategory.name" id="placeCategory_name" class="required" value="{$category['common']['content']}" readonly="true" />
                            <input type="hidden" name="placeCategory.id" id="placeCategory_id" value="{$category['common']['id']}" />
                            <a class="btnLook"  href="{eval echo site_url(array('poi', 'category', 'view_tree', 'is_brand', '0'))}" lookupGroup="placeCategory">查询分类</a>
                        </dd>
                    </dl>
              <!--       <dl>
                        <dt>
                            品牌企业：
                        </dt>
                        <dd>
                            <input type="text" size="40" name="placeBrand.name" id="placeBrand.name" value="{$category['brand']['content']}" readonly="true" />
                            <input type="hidden" name="placeBrand.id" value="{$category['brand']['id']}" />
                            <a class="btnLook" href="{eval echo site_url(array('poi', 'category', 'view_tree', 'is_brand', '1'))}" lookupGroup="placeBrand">查询品牌</a>
                        </dd>
                    </dl> --> 
                    <dl>
                        <dt>
                            图标：
                        </dt>
                        <dd>
                            <button type="button" id="poi_icon">上传图标</button>
                        </dd>
                    </dl>
           <!--          <dl>
                        <dt>
                            WP图标：
                        </dt>
                        <dd>
                            <button type="button" id="poi_wp_icon">上传图标</button>
                        </dd>
                    </dl> -->
                    <dl>
                        <dt>
                            电话：
                        </dt>
                        <dd>
                            <input type="text" size="40" name="tel" id="tel" value="{$poi['tel']}" alt="多个电话用空格分隔" />(多个电话用空格分隔)
                        </dd>
                    </dl>
                    <dl>
                        <dt>经营性场所：</dt>
                        <dd>
                            <input type="checkbox" name="is_business" <!--{if $poi['isBusiness']}--> checked="checked"<!--{/if}--> value="1" />
                        </dd>
                    </dl>
                    <dl>
                        <dt>返还积分：</dt>
                        <dd>
                            <input type="checkbox" name="isRepayPoint" <!--{if $poi['isRepayPoint']}--> checked="checked"<!--{/if}--> value="1" />
                        </dd>
                    </dl>
                     <dl>
                        <dt>封面图片：</dt>
                        <dd>
                        	<div id="poi_tmp_image_block">
                            {if $poi['background']}
                            <div style="width:150px; height:140px;float:left">
					           <img src="{echo image_url($poi['background'],'common');}" width=140 height=140 />
					        </div>
					        {/if}
					        </div>
					        <div style="width:100px; height:140px;float:left" id="poi_edit_image_block">
           						<input type="button" onclick="$.pdialog.open('/poi/poi/poi_select_image/id/{eval echo intval($poi['id']);}/rel/poi_poi_add' , 'poi_poi_select_image'  , '编辑封面图片' , {width:1110,height:500,close:imgareaselect_close})" value="编辑" />
           
            				</div>
            				<input type="hidden" id="poi_background" name="background"  />
                        </dd>
                    </dl>
                    <!--{eval $place_id = $poi['id']?$poi['id']:0}-->
                    <!--{template poi/place_block}-->                    
                    </td>
                    <td width="400" valign="top"><iframe src="/static/fragment/map_soso.html?poi_add" scrolling="no" width="400" height="450" frameborder="0"></iframe></td>
                </tr>
            </table>
        </div>
        <div class="formBar">
            <ul>
                <li>
                    <div class="buttonActive">
                        <div class="buttonContent">
                            <button type="submit" id="btnSubmit">
                                保存
                            </button>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="button">
                        <div class="buttonContent">
                            <button type="button" class="close">
                                取消
                            </button>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </form>
</div>

<script type="text/javascript">
    <!--{if $module_id_json}-->
    var moduleIds = eval('({$module_id_json})');
    <!--{else}-->
    var moduleIds = {};
    <!--{/if}-->

    $(function() {
        var options = "name:\"poi_icon[]\", id:\"poi_icon\", file_type:\"common\", resolution:'odp',  required:false";
        <!--{if $poi['icon']}-->
            options += ", image_name: \"{$poi['icon']}\"";
        <!--{/if}-->
        $("#poi_icon", $("#poi_add")).my_upload(eval("({" + options + "})"));

        options = "name:\"poi_icon[]\", id:\"poi_wp_icon\", file_type:\"common\", resolution:'wdp', required:false";
        <!--{if $poi['icon']}-->
            options += ", image_name: \"{$poi['icon']}\"";
        <!--{/if}-->
        $("#poi_wp_icon", $("#poi_add")).my_upload(eval("({" + options + "})"));

/*
        $("#place_module", $("#poi_add")).change(function() {
            var id = $(this).val();
            load_module(id);
        });
*/
        
        //<!--if $poi['placeModule']-->
/*
        $("#place_module", $("#poi_add")).val("{$poi['placeModule']}");
        load_module({$poi['placeModule']});
*/
        //<!--/if-->
        
        $("#is_business", $("#poi_add")).click(function(){
            if($(this).attr("checked")) {
                $("#pcc_dl", $("#poi_add")).show();
            } else {
                $("#pcc_dl", $("#poi_add")).hide();
            }
        });
        
        $("#btn_add_module", $("#poi_add")).click(function(){
            $("input[name=place_module]:checked", $("#poi_add")).each(function(){
                var moduleId = $(this).val();
                if(moduleId == 0) {
                    // 没有选择要添加的模型
                    alertMsg.error("亲，请选择添加的模型");
                    return;
                }
    
                // 判断这个模型ID已经添加过了，一个POI不能添加两个相同的模型
                if(moduleIds['id_' + moduleId] > 0) {
                    alertMsg.error("亲，这个模型【" + $(this).attr("text") + "】已经添加过了");
                    return;
                }
                
                moduleIds['id_' + moduleId] = 1;
                
                var ext = $("<div id=\"place_ext_" + moduleId + "\"></div>");
                $("#place_ext", $("#poi_add")).append(ext);
                ext.loadUrl("{eval echo site_url(array('poi', 'module', 'add_module_data', 'id'))}/" + moduleId, {place_id:"{$poi['id']}"});
            });
        });
        
        // 编辑的时候导入地点的模型
        <!--{loop $poi['module'] $row}-->
            var ext = $("<div id=\"place_ext_{$row['id']}\"></div>");
            $("#place_ext", $("#poi_add")).append(ext);
            ext.loadUrl("{eval echo site_url(array('poi', 'module', 'add_module_data', 'id', $row['id']))}", {place_id:"{$poi['id']}"});
        <!--{/loop}-->

    });
    
    function del_add_module_data(moduleId) {
        moduleIds['id_' + moduleId] = 0;
        $("#add_module_data_" + moduleId, $("#poi_add")).remove();
    }
    
    function hidden_add_module_data(obj, moduleId) {
        var status = parseInt($(obj).attr("status"));
        var b = status == 1?false:true;
        $("#add_module_data_field_" + moduleId, $("#poi_add")).toggle(b);
        $(obj).attr("status", status == 1?0:1);
        $(obj).text(b?"隐藏":"展开");
    }
    
    // function load_module(id) {
        // if(0 == id) {
            // $("#place_ext", $("#poi_add")).html("");
        // } else {
            // $("#place_ext", $("#poi_add")).loadUrl("eval echo site_url(array('poi', 'module', 'add_module_data', 'id'))/" + id, {place_id:'{poi['id']}'});
        // }
    // }
</script>
