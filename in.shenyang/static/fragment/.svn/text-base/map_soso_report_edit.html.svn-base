<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>SOSOMap</title>
        <style type="text/css">
            * {
                margin: 5px 10px;
                padding: 0px;
            }
            body, button, input, select, textarea {
                font: 12px                  /16px Verdana, Helvetica, Arial, sans-serif;
            }
        </style>
        <script src="/static/js/dwz/js/jquery-1.7.1.js" type="text/javascript"></script>
        <script charset="utf-8" src="http://api.map.soso.com/v1.0/main.js"></script>
        <script>
            var div_id = window.location.search.substring(1);

            var map, geocoder, marker = null;
            function init() {
                // 去获取父窗口的纬度、经度值，如果没有则定位到成都
                // 获取地点的经纬度
                // 纬度
                var p_latitude = parseFloat($(window.parent.document).find("#" + div_id).find("#p_latitude").val());
                // 经度
                var p_longitude = parseFloat($(window.parent.document).find("#" + div_id).find("#p_longitude").val());

                var p_myLatLng = new soso.maps.LatLng(p_latitude, p_longitude);
                // 初始定位标记
                map = new soso.maps.Map(document.getElementById('container'), {
                    center : p_myLatLng,
                    zoomLevel : 14
                });

                // 地址解析对象
                geocoder = new soso.maps.Geocoder();

                //添加地图导航平移控件
                var navControl = new soso.maps.NavigationControl({
                    align : soso.maps.ALIGN.TOP_LEFT,
                    margin : new soso.maps.Size(5, 15),
                    map : map
                });

                if(marker != null) {
                    marker.setMap(null);
                }
                marker = new soso.maps.Marker({
                    position : p_myLatLng,
                    draggable : true,
                    map : map
                });

                soso.maps.Event.addListener(marker, "dragend", function() {
                    var latLng = marker.getPosition();
                    lat = latLng.getLat().toFixed(7);
                    lng = latLng.getLng().toFixed(7);

                    $(window.parent.document).find("#" + div_id).find("#p_latitude").val(lat);
                    $(window.parent.document).find("#" + div_id).find("#p_longitude").val(lng);
                });
                // 标记用户提交的地点
                // 纬度
                var u_latitude = parseFloat($(window.parent.document).find("#" + div_id).find("#latitude").val());
                // 经度
                var u_longitude = parseFloat($(window.parent.document).find("#" + div_id).find("#longitude").val());
                var u_myLatLng = new soso.maps.LatLng(u_latitude, u_longitude);
                
                var anchor = new soso.maps.Point(6, 6),size = new soso.maps.Size(24, 24),icon = new soso.maps.MarkerImage('/static/skin/center.gif', size, anchor); 
                var uMarker = new soso.maps.Marker({
                    icon : icon,
                    position : u_myLatLng,
                    map : map
                });
            }
        </script>
    </head>
    <body onload="init();">
        <div style="width:540px;height:280px;" id="container"></div>
    </body>
</html>