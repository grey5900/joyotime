!function(n){n(function(){n(".praise").live("click",function(){if(n.is_signin())btn=n(this),n.ajax({type:"POST",url:"/praise/",data:{id:btn.attr("date-id"),type:btn.attr("date-target")},cache:!1,dataType:"json",success:function(t){n("#messager").messager({message:t.msg}),t.code==1&&btn.text("已赞").removeClass("praise").addClass("praised").off()}});else return!1;return!1}),n(".favorite").live("click",function(){if(n.is_signin())btn=n(this),n.ajax({type:"POST",url:"/favorite/",data:{id:btn.attr("date-id"),type:btn.attr("date-target")},cache:!1,dataType:"json",success:function(t){n("#messager").messager({message:t.msg}),t.code==1&&btn.text("已收藏").removeClass("favorite").addClass("favorited").off()}});else return!1;return!1}),n(".reply").live("click",function(){if(n.is_signin()){var t=n(this);n("#reply-form").load("/show_form/reply",function(i){n("#reply-form").html(i),n("#reply-form").modal("show"),n("#reply-form h3").html("回复 <strong>"+t.attr("date-target")+"</strong> ："),n("#reply_id").val(t.attr("date-id")),n("#reply_uid").val(t.attr("date-uid")),n("#reply_to").val(t.attr("date-type")),n("#reply-form textarea").text("").focus(),n("#reply-form textarea").charCount({allowed:140,warning:25,css:"counter",counterElement:"span",cssWarning:"warning",cssExceeded:"exceeded",counterText:"还可以输入"})})}else return!1;return!1});n("#reply-form").on("submit",function(){var t=n(this);return t.find("textarea").is_empty()?!1:(t.modal("hide"),n.ajax({type:"POST",url:t.attr("action"),data:t.serialize(),cache:!1,dataType:"json",success:function(t){n("#messager").messager({message:t.msg}),t.code==1&&n("#reply-count-"+t.id).plus(1)}}),!1)});n(".share").on("click",function(){if(n.is_signin())n("#share-form").load("/show_form/share",function(t){n("#share-form").html(t),n("#share-form").modal("show"),n("#share_id").val(dom.attr("date-id")),n("#share-form textarea").focus()});else return!1;return!1});n("#share-form").on("submit",function(){return n.post(n(this).attr("action"),n(this).serialize(),n(this).modal("hide")),!1});var t=n(".thumbnails");t.masonry({itemSelector:".thumbnail"}),t.infinitescroll({navSelector:".pagination",nextSelector:'.pagination a:contains("下一页")',itemSelector:".thumbnail",extraScrollPx:500,loading:{finished:undefined,finishedMsg:"没有更多了...",img:"/img/loading.gif",msg:null,msgText:"",selector:null,speed:"fast",start:undefined}},function(i){var r=n(i).css({opacity:0});r.animate({opacity:1}),t.masonry("appended",r,!0)}),n("#returntop").returntop()})}(window.jQuery)