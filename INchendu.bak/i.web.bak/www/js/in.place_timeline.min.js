$(function(){$("#star-ranker .ranker").raty({hints:["很差","差","一般","好","很好"],half:!1,target:"#star-ranker .hint",targetKeep:!0});$(".review-bd").on("focusin mousedown",function(){return $.is_signin()?!0:!1});$("form#tip-post").on("submit",function(){var t=$(this),n=t.find(".reply-write").first();return n.is_empty()?!1:n.val().length<10?($("#messager").messager({message:"请输入10个字以上的点评"}),!1):n.val().length>500?($("#messager").messager({message:"点评字数限制在500个字以内"}),!1):void 0});$("form#photo-post").on("submit",function(){var n=$(this),i=n.find(".reply-write").first(),t=n.find("#upload").first();return t.is_empty()?($("#messager").messager({message:"请选择要上传的照片"}),!1):i.val().length>500?($("#messager").messager({message:"点评字数限制在500个字以内"}),!1):void 0});$('.btn.favorite[disabled!="disabled"]').on("click",function(){var n=$(this),i,t;if($.is_signin())i=n.attr("date-id"),t=n.attr("date-type"),$.ajax({type:"POST",url:"/favorite/",data:{id:i,type:t},dataType:"json",success:function(t){t.code!=1?$("#messager").messager({message:t.msg}):n.text("已收藏").removeClass("btn-primary favorite").addClass("favorited disabled").off()}});else return!1});$(".btn.place-report").on("click",function(){if(!$.is_signin())return!1});$("#mapCon").on("click",function(){$("#place-map").modal("show")});$("#place-map").on("shown",function(){$("#place-map-container").html("");var n=new soso.maps.Marker({position:new soso.maps.LatLng($("#place-map-container").attr("data-lat"),$("#place-map-container").attr("data-lng"))});$("#place-map-container").mapper({zoomLevel:15,marker:n})});$("#place-report-list a").on("click",function(){var n=$(this);switch(n.attr("data-type")){case"map":$("#place-report-form-map").modal("show");break;case"info":$("#place-report-form-info").modal("show");break;case"other":$("#place-report-form-other").modal("show");break;default:$.ajax({type:"POST",url:"/place_report/"+n.attr("date-id"),data:{type:n.attr("data-err")},dataType:"json",success:function(n){$("#messager").messager({message:n.msg})}})}});$("#place-report-form-map").on("shown",function(){var t=$(this).find("input[type=submit]"),i=$("#coordinate"),n;t.prop({disabled:!0}),$("#map").html(""),n=new soso.maps.Marker({position:new soso.maps.LatLng($("#map").attr("data-lat"),$("#map").attr("data-lng")),draggable:!0}),$("#map").mapper({zoomLevel:15,marker:n,after:function(){soso.maps.Event.addListener(n,"dragend",function(){var r=n.getPosition();i.val(r),t.prop({disabled:!1})})}})});$("#place-report-form-map").on("submit",function(){var n=$(this),t=n.find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:n.attr("action"),data:n.serialize(),dataType:"json",success:function(i){$("#messager").messager({message:i.msg}),t.button("reset"),i.code==1&&n.modal("hide")}}),!1});$("#place-report-form-info").on("submit",function(){var n=$(this),r=n.find("input[type=submit]"),t=n.find("input[name=place_name]"),i=n.find("input[name=place_address]");return t.is_empty()||i.is_empty()?!1:t.val()==t.attr("data-source")&&i.val()==i.attr("data-source")?($("#messager").messager({message:"请输入新的地点信息"}),!1):(r.button("loading"),$.ajax({type:"POST",url:n.attr("action"),data:n.serialize(),dataType:"json",success:function(t){$("#messager").messager({message:t.msg}),r.button("reset"),t.code==1&&n.modal("hide")}}),!1)});$("#place-report-form-other").on("submit",function(){var n=$(this),t=n.find("input[type=submit]"),i=n.find("textarea[name=content]");return i.is_empty()?!1:(t.button("loading"),$.ajax({type:"POST",url:n.attr("action"),data:n.serialize(),dataType:"json",success:function(i){$("#messager").messager({message:i.msg}),t.button("reset"),i.code==1&&n.modal("hide")}}),!1)});if($("#pcc").on("keyup",function(){$(this).val($(this).val().replace(/\D|^0/g,""))}).on("paste",function(){$(this).val($(this).val().replace(/\D|^0/g,""))}).css("ime-mode","disabled"),$.browser.mozilla&&online_id)$(".photo-selector label").on("click",function(){$("#upload").click()});$("#upload").on("change",function(){var r=$(".photo-preview"),u=["gif","jpeg","jpg","bmp","png"],n=this,t,i;if(n.value){if(!RegExp(".("+u.join("|")+")$","i").test(this.value.toLowerCase()))return alert("照片必须为"+u.join("，")+"中的一种，请重选"),n.value="",r.fadeOut(),!1;n.files?(t=n.files[0],i=new FileReader,i.onloadend=function(n){typeof n=="object"&&(n=n.target.result),r.css({"background-size":"cover","background-image":"url("+n+")"}).fadeIn()},i.readAsDataURL(t)):(n.select(),t=document.selection.createRange().text,r.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"',sizingMethod='scale')"}).fadeIn())}});var t=$("#sync-settings span.sync-sina"),n=$("#sync-settings span.sync-tencent");$.cookie("is_sync_sina")==!1&&(t.removeClass("on"),t.find("input[type=checkbox]").prop("checked",!1)),$.cookie("is_sync_tencent")==!1&&(n.removeClass("on"),n.find("input[type=checkbox]").prop("checked",!1));$(".sync-settings span.sync-sina, .sync-settings span.sync-tencent").on("click",function(){var t=$(this),n=t.find("input[type=checkbox]");t.toggleClass("on"),n.prop("checked",!n.prop("checked"))});$("a.item-qrcode[rel=popover]").popover({html:!0}).click(function(n){n.preventDefault()}),$(".popover .close").live("click",function(){$("a[rel='popover']").popover("hide")})})