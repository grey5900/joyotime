$(function(){$.validator.addMethod("validusername",function(n,t){return this.optional(t)||/^[a-zA-Z0-9_]{1,15}$/.test(n)},"User Name Error."),$.validator.addMethod("validpassword",function(n,t){return this.optional(t)||/^[a-zA-Z0-9_\`\~\!\@\#\$\%\^\&\*\(\)\-\=\+\[\]\{\}\\\|\;\:\'\"\<\>\,\.\/\?]{2,15}$/.test(n)},"Password Error."),$.validator.addMethod("validcellphone",function(n,t){return this.optional(t)||/^(1(([35][0-9])|(47)|[8][01236789]))\d{8}$/.test(n)},"Cellphone Error."),$.validator.addMethod("checkusername",function(n){var i=!1;return $.ajax({type:"GET",url:"/check_username/"+n,async:!1,cache:!1,dataType:"json",success:function(n){n.code==1&&(i=!0)}}),i}),$.validator.addMethod("checktaboo",function(n){var i=!1;return $.ajax({type:"POST",url:"/check_taboo/",data:{content:n},async:!1,cache:!1,dataType:"json",success:function(n){n.code==1&&(i=!0)}}),i}),$.validator.addMethod("checkemail",function(n){var i=!1;return $.ajax({type:"POST",url:"/check_email/",async:!1,data:"email="+n,cache:!1,dataType:"json",success:function(n){n.code==1&&(i=!0)}}),i}),$.validator.addMethod("checkcaptcha",function(n){var i=!1;return $.ajax({type:"POST",url:"/check_captcha/",async:!1,data:"captcha="+n,cache:!1,dataType:"json",success:function(n){n.code==1&&(i=!0)}}),i}),$("#signin-form").validate({rules:{username:{required:!0},password:{required:!0},verifycode:{required:!0}},messages:{username:{required:"请输入用户名"},password:{required:"请输入密码"},verifycode:{required:"请输入验证码"}},highlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("valid success valid").addClass("error"):$(n).closest(".control-group").removeClass("valid success valid").addClass("error")},unhighlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("valid"):$(n).closest(".control-group").removeClass("error success valid").addClass("valid")},success:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("success"):$(n).closest(".control-group").removeClass("error success valid").addClass("success")},submitHandler:function(n){var t=$(n).find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:$(n).attr("action"),data:$(n).serialize(),dataType:"json",success:function(n){n.code==1?n.refer!=""?window.location.href=n.refer:window.location.reload():($(".alert-error").html(n.msg),$(".alert-error").show(),t.button("reset"))}}),!1}}),$("#signup-form").validate({rules:{username:{required:!0,checkusername:!0,validusername:!0},password:{required:!0,validpassword:!0},password_again:{equalTo:"#password",required:!0},email:{email:!0,checkemail:!0},nickname:{checktaboo:!0},recommender:{number:!0},verifycode:{required:!0}},messages:{username:{required:"请输入用户名",checkusername:'帐号已存在，请直接<a href="account_signin.php">登录</a>或更换用户名',validusername:"用户名不合法"},password:{required:"请输入密码",validpassword:"密码不合法"},password_again:{equalTo:"两次输入的密码不一致",required:"请输入确认密码"},email:{email:"请输入正确的邮箱地址",checkemail:'帐号已存在，请直接<a href="account_signin.php">登录</a>或更换邮箱'},nickname:{checktaboo:"昵称包含不适宜内容，请重新输入"},recommender:{number:"请输入正确的推荐人ID"},verifycode:{required:"请输入验证码"}},highlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("valid success valid").addClass("error"):$(n).closest(".control-group").removeClass("valid success valid").addClass("error")},unhighlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("valid"):$(n).closest(".control-group").removeClass("error success valid").addClass("valid")},success:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("success"):$(n).closest(".control-group").removeClass("error success valid").addClass("success")},submitHandler:function(n){var t=$(n).find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:$(n).attr("action"),data:$(n).serialize(),dataType:"json",success:function(n){n.code==1?n.refer!=""?window.location.href=n.refer:window.location.reload():(alert(n.msg),t.button("reset"))}}),!1}}),$("#complete-form").validate({rules:{username:{required:!0,checkusername:!0,validusername:!0},password:{required:!0,validpassword:!0},password_again:{equalTo:"#password",required:!0},email:{email:!0,checkemail:!0},nickname:{checktaboo:!0},recommender:{number:!0}},messages:{username:{required:"请输入用户名",checkusername:'帐号已存在，请直接<a href="account_signin.php">登录</a>或更换用户名',validusername:"用户名不合法"},password:{required:"请输入密码",validpassword:"密码不合法"},password_again:{equalTo:"两次输入的密码不一致",required:"请输入确认密码"},email:{email:"请输入正确的邮箱地址",checkemail:'帐号已存在，请直接<a href="account_signin.php">登录</a>或更换邮箱'},nickname:{checktaboo:"昵称包含不适宜内容，请重新输入"},recommender:{number:"请输入正确的推荐人ID"}},highlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("valid success valid").addClass("error"):$(n).closest(".control-group").removeClass("valid success valid").addClass("error")},unhighlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("valid"):$(n).closest(".control-group").removeClass("error success valid").addClass("valid")},success:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("success"):$(n).closest(".control-group").removeClass("error success valid").addClass("success")},submitHandler:function(n){var t=$(n).find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:$(n).attr("action"),data:$(n).serialize(),dataType:"json",success:function(n){n.code==1?n.refer!=""?window.location.href=n.refer:window.location.reload():($("#messager").messager({message:n.msg}),t.button("reset"))}}),!1}}),$("#email-form").validate({rules:{password:{required:!0},email:{required:!0,email:!0}},message:{password:{required:"请输入登录密码"},email:{required:"请输入邮箱地址",email:"请输入正确的邮箱地址"}},highlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("valid success valid").addClass("error"):$(n).closest(".control-group").removeClass("valid success valid").addClass("error")},unhighlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("valid"):$(n).closest(".control-group").removeClass("error success valid").addClass("valid")},success:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("success"):$(n).closest(".control-group").removeClass("error success valid").addClass("success")},submitHandler:function(n){var t=$(n).find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:$(n).attr("action"),data:$(n).serialize(),dataType:"json",success:function(n){n.code==1?n.refer!=""?window.location.href=n.refer:window.location.reload():($(".alert-error").html(n.msg),$(".alert-error").show,t.button("reset"))}}),!1}}),$("#revisepassword-form").validate({rules:{oldpwd:{required:!0},newpwd:{required:!0,validpassword:!0},renew:{required:!0,equalTo:"#newpwd"}},messages:{oldpwd:{required:"请输入登录密码",validpassword:"密码不合法"},newpwd:{required:"请输入新密码",validpassword:"密码不合法"},renew:{required:"请再次输入新密码",equalTo:"两次输入的密码不一致"}},highlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("valid success valid").addClass("error"):$(n).closest(".control-group").removeClass("valid success valid").addClass("error")},unhighlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("valid"):$(n).closest(".control-group").removeClass("error success valid").addClass("valid")},success:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("success"):$(n).closest(".control-group").removeClass("error success valid").addClass("success")},submitHandler:function(n){var t=$(n).find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:$(n).attr("action"),data:$(n).serialize(),dataType:"json",success:function(n){n.code==1?n.refer!=""?window.location.href=n.refer:window.location.reload():($(".alert-error").html(n.msg),$(".alert-error").show,t.button("reset"))}}),!1}}),$("#user-settings-form").validate({rules:{nickname:{checktaboo:!0},description:{checktaboo:!0},tel:{validcellphone:!0}},messages:{nickname:{checktaboo:"昵称包含不适宜内容，请重新输入"},description:{checktaboo:"签名包含不适宜内容，请重新输入"},tel:{validcellphone:"请输入正确的手机号码"}},highlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("valid success valid").addClass("error"):$(n).closest(".control-group").removeClass("valid success valid").addClass("error")},unhighlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("valid"):$(n).closest(".control-group").removeClass("error success valid").addClass("valid")},success:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("success"):$(n).closest(".control-group").removeClass("error success valid").addClass("success")},submitHandler:function(n){var t=$(n).find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:$(n).attr("action"),data:$(n).serialize(),dataType:"json",complete:function(){t.button("reset")},success:function(n){$("#messager").messager({message:n.msg,refer:"reload"})}}),!1}}),$("#resetpassword-form").validate({rules:{email:{required:!0,email:!0}},messages:{email:{required:"请输入邮箱地址",email:"请输入正确的邮箱地址"}},highlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("valid success valid").addClass("error"):$(n).closest(".control-group").removeClass("valid success valid").addClass("error")},unhighlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("valid"):$(n).closest(".control-group").removeClass("error success valid").addClass("valid")},success:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("success"):$(n).closest(".control-group").removeClass("error success valid").addClass("success")},submitHandler:function(n){var t=$(n).find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:$(n).attr("action"),data:$(n).serialize(),dataType:"json",success:function(n){t.button("reset"),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)&&n.code==1?window.close():n.code==1&&(window.location.href="/")}}),!1}}),$("#resetpassword-form-1").validate({rules:{newpwd:{required:!0,validpassword:!0},repwd:{required:!0,equalTo:"#newpwd"}},messages:{newpwd:{required:"请输入新密码"},repwd:{equalTo:"两次输入的密码不一致",required:"请输入确认密码"}},highlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("valid success valid").addClass("error"):$(n).closest(".control-group").removeClass("valid success valid").addClass("error")},unhighlight:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("valid"):$(n).closest(".control-group").removeClass("error success valid").addClass("valid")},success:function(n){n.type==="radio"?this.findByName(n.name).closest(".control-group").removeClass("error success valid").addClass("success"):$(n).closest(".control-group").removeClass("error success valid").addClass("success")},submitHandler:function(n){var t=$(n).find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:$(n).attr("action"),data:$(n).serialize(),dataType:"json",success:function(n){alert(n.msg),t.button("reset"),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)&&n.code==1?window.close():n.code==1&&(window.location.href="/signin")}}),!1}}),$("#signature").charCount({allowed:30,warning:0,css:"counter",counterElement:"span",cssWarning:"warning",cssExceeded:"exceeded",counterText:"还可以输入"}),$("#telephone").on("keyup",function(){$(this).val($(this).val().replace(/\D|^0/g,""))}).on("paste",function(){$(this).val($(this).val().replace(/\D|^0/g,""))}).css("ime-mode","disabled")})