function preview(a,b){$("#photo").width,$("#photo").height;var e=160/b.width,f=160/b.height;$("#preview img").css({width:Math.round(360*e)+"px",height:Math.round(360*f)+"px",marginLeft:"-"+Math.round(e*b.x1)+"px",marginTop:"-"+Math.round(f*b.y1)+"px"}),$("#x1").val(b.x1),$("#y1").val(b.y1),$("#x2").val(b.x2),$("#y2").val(b.y2),$("#w").val(b.width),$("#h").val(b.height)}$(function(){$(".show-avatar").hide(),$.getScript("/static/js/jquery.imgareaselect.min.js"),$.getScript("/static/js/account.min.js"),$.getScript("/static/js/jquery.ajaxfileupload.min.js",function(){$.browser.mozilla&&$("#avatarCover").on("click",function(a){$(a.target).is("label")&&$("#avatar").trigger("click")}),$("#avatarCover").delegate("#fileupload-exists","click",function(){var a=$("#avatarCover");a.empty();var b=$("<input type='file' class='imgbtn' name='Filedata' id='avatar'/>");$(b).appendTo(a),$(".show-avatar").hide()}),$("#avatarCover").delegate("#avatar","change",function(){var $this=$(this);if($("#avatarCover").ajaxStart(function(){$(this).addClass("loading")}).ajaxComplete(function(){$(this).removeClass("loading")}),""!=$this.val()){var cover=$("#avatarCover");$.ajaxFileUpload({url:"/upload/avatar",secureuri:!1,fileElementId:"avatar",data:{uploadFile:$this.attr("name"),uid:online_id},dataType:"json",success:function(data,status){var data=eval("("+data+")"),img=data.msg;if(1==data.code){cover.html(""),cover.append('<div id="preview_big"></div>');var a_del=$("<a href='javascript:void(0)' class='close' id='fileupload-exists'>&times;</a>");$(".show-avatar").show();var preview_big=$("#preview_big");preview_big.append(a_del),preview_big.append('<img id="photo" style="width: 360px; height: 360px;"/>'),$("#preview").append('<img id="thumb" style="width: 160px; height: 160px;"/>'),$("#photo").attr({src:img}),$("#thumb").attr({src:img}),$("#image_src").val(img),$("#photo").imgAreaSelect({aspectRatio:"1:1",handles:!0,fadeSpeed:200,resizeable:!1,onSelectChange:preview})}else $.messager(data.msg)}}),$this.val("")}})}),$("#upload_thumb").on("submit",function(){var a=$("#save_avatar");return a.button("loading"),$.ajax({type:"POST",url:$("#upload_thumb").attr("action"),data:$("#upload_thumb").serialize(),dataType:"json",success:function(b){-1==b.code?($.messager(b.msg),a.button("reset")):($.getScript("/sso"),$.messager(b.msg,"reload",function(){a.button("reset")}),$("#image_src").val(""))}}),!1})});