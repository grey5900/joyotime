function get_image_url(n,t){$.getJSON("/active_source/get_image_url",{file_name:n.file_name,file_type:n.file_type,resolution:n.resolution},function(n){t&&t(n)})}$(function(){function n(n,t){$.ajax({url:"/babyclock/get_info/"+n+"/"+t,type:"GET",dataType:"json",cache:!1,success:function(n){n.id&&(window.location.href="/babyclock/"+n.id)}})}var t=$("#detail-countdown");t[0]&&(detailcountdown=setInterval(function(){var t=new Date;$("#detail-countdown").html($.padNum(t.getHours(),2)+":"+$.padNum(t.getMinutes(),2)+":"+$.padNum(t.getSeconds(),2)),t.getSeconds()==0&&n(t.getHours(),t.getMinutes())},1e3));$(".imgartwork").on("mouseover",function(){$(this).find(".action-support").fadeIn()}).on("mouseleave",function(){$(this).find(".action-support").fadeOut()});$(".action-support").on("click",function(){var n=$(this);$.ajax({url:"/babyclock/support/"+n.data("id"),type:"GET",dataType:"json",cache:!1,success:function(n){n.code==1?$.messager("谢谢你的支持"):$.messager(n.msg)}})});$("#babyclock-upload-btn").on("click",function(){if(!$.checkAuth())return!1})}),function(n){n.fn.extend({my_upload:function(t){function k(){myFrame=arguments[0],image_name=arguments[1]?arguments[1]:t.image_name,i=n('<form action="'+h+'" method="post" enctype="multipart/form-data"><\/form>').css({margin:"0px"}),typeof t.up_url!="undefined"&&t.up_url!=""&&(typeof t.width!="undefined"&&t.width>0&&n("<input />").attr({type:"hidden",name:"tw"}).val(t.width).appendTo(i),typeof t.height!="undefined"&&t.height>0&&n("<input />").attr({type:"hidden",name:"th"}).val(t.height).appendTo(i)),c=n("<span><\/span>").css({"font-size":"12px",overflow:"hidden",position:"absolute"}),l=n('<input type="file" name="file" size="1">').css({position:"absolute","z-index":"100","margin-left":"-180px","font-size":"60px",opacity:"0",filter:"alpha(opacity=0)","margin-top":"-5px"}),b=n('<button type="button">'+y.text()+"<\/button>");var k=eval("("+p+")");typeof t.water!="undefined"&&t.water!=""&&(k.water=t.water,k.location=t.location),k.input=t.input,l.click(function(){t.resolution!=""&&t.change_name==!1&&n("input[name='"+t.name+"']",o[0].window).each(function(){if(n(this).val()!=""){var t=n("input[name=file_name]",i);t?t.val(n(this).val()):i.append('<input type="hidden" name="file_name" value="'+n(this).val()+'" />');return}})}),l.change(function(){var t=n("input[name=sign]",i);t.val()==undefined&&(t=n('<input type="hidden" name="sign" value="" />'),i.append(t)),n.get("/active_source/rsa_sign",function(n){t.val(n),i.submit()})}),frame=n.isPlainObject(myFrame)?myFrame:u,frame.contents().find("body").html(""),frame.contents().find("body").css({margin:"0px"}),frame.contents().find("body").append(i),i.append(c),c.append(l),c.append(b),n.each(k,function(n,t){i.append('<input type="hidden" name="'+n+'" value="'+t+'" />')}),html=frame.contents().find("body").html(),image_name&&get_image_url({file_name:image_name,file_type:t.file_type,resolution:t.resolution},function(i){r=n("#"+w),r.length==0?(r=n('<div id="'+w+'"><\/div>').css({position:"relative",width:"200px","text-align":"center",border:"1px solid #9cc67e",height:t.thumb_height+"px",overflow:"hidden"}),f=n('<a rel="'+t.id+'"><\/a>'),a=n('<img height="'+t.thumb_height+'" border="0"  />'),s=n("<div><\/div>").css({position:"absolute",left:"0px",right:"0px",bottom:"0px",height:"20px",background:"#9cc67e",opacity:"0.8",filter:"alpha(opacity=80)",display:"none"}),v=n('<a href="javascript:;">删除<\/a>').css({"line-height":"20px"}),f.append(a),s.append(v),r.append(f),r.append(s),o.append(r)):(f=n("a[rel="+t.id+"]",r),a=n("img",r),v=n("a[href='javascript:;']",r)),f.fancybox(),v.click(function(){n(n(this).parent().parent()).hide(),e.val("")}),r.hover(function(){s.show()},function(){s.hide()}),f.attr("href",i.source_image+"?"+(new Date).getTime()),a.attr("src",i.image+"?"+(new Date).getTime()),r.show(),t.is_rec==0?(e.val(i.image_name),e.trigger("change")):n("#"+t.name).val(i.image+"?"+(new Date).getTime())})}var y=n(this),h,p,e,o,u,i,c,l,b,w,r,f,a,s,v;if(t=n.extend({file_type:"",name:"upload_image_name",id:"upload_image_id",file_name:"",resolution:"",image_name:"",required:!0,thumb_height:100,change_name:!1,up_url:"",width:0,height:0,is_rec:0,water:"",location:9,input:"file"},t),t.file_type=="")return alert("请设置上传文件类型"),!1;t.resolution==""?(h=conf_save_image_uri,p="{file_type: options.file_type}"):(h=conf_transfer_image_uri,p="{file_type: options.file_type, file_name: options.file_name , resolution: options.resolution}"),typeof t.up_url!="undefined"&&t.up_url!=""&&(h=t.up_url),e=n('<input type="hidden"'+(t.required?'class="required"':"")+' name="'+t.name+'" id="'+t.id+'" />'),y.parent().append(e),o=n("<div><\/div>"),u=n('<iframe style="border:0px;height:30px;width:200px;" frameborder="0" border="0" cellspacing="0" id="iframe_'+t.id+'" name="iframe_'+t.id+'" allowtransparency="true" scrolling="no" resizable="no"><\/iframe>'),o.append(u),u.domain="*",setTimeout(k,200),w="ooxx_image_span_id_"+t.id,u.unbind().load(function(){var i=document.getElementById(u.attr("id")),r=n(i.contentWindow.document.body).text(),t;r&&(t=eval("("+r+")"),t.result_code==0?k(n(i),t.file_name):alertMsg.error(t.result_msg))}),y.replaceWith(o)}})}(jQuery)