(function(n,t,i){t.infinitescroll=function(n,i,r){this.element=t(r),this._create(n,i)||(this.failed=!0)},t.infinitescroll.defaults={loading:{finished:i,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:i},state:{isDuringAjax:!1,isInvalidPage:!1,isDestroyed:!1,isDone:!1,isPaused:!1,currPage:1},callback:i,debug:!1,behavior:i,binder:t(n),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:!1,pathParse:i,dataType:"html",appendCallback:!0,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:i,path:i},t.infinitescroll.prototype={_binding:function(n){var r=this,t=r.options;if(t.v="2.0b2.111027",!!t.behavior&&this["_binding_"+t.behavior]!==i){this["_binding_"+t.behavior].call(this);return}if(n!=="bind"&&n!=="unbind")return this._debug("Binding value  "+n+" not valid"),!1;n=="unbind"?this.options.binder.unbind("smartscroll.infscr."+r.options.infid):this.options.binder[n]("smartscroll.infscr."+r.options.infid,function(){r.scroll()}),this._debug("Binding",n)},_create:function(n,r){var u=t.extend(!0,{},t.infinitescroll.defaults,n),f;return this._validate(n)?(this.options=u,f=t(u.nextSelector).attr("href"),!f)?(this._debug("Navigation selector not found"),!1):(u.path=this._determinepath(f),u.contentSelector=u.contentSelector||this.element,u.loading.selector=u.loading.selector||u.contentSelector,u.loading.msg=t('<div id="infscr-loading"><img alt="Loading..." src="'+u.loading.img+'" /><div>'+u.loading.msgText+"</div></div>"),(new Image).src=u.loading.img,u.pixelsFromNavToBottom=t(document).height()-t(u.navSelector).offset().top,u.loading.start=u.loading.start||function(){t(u.navSelector).hide(),u.loading.msg.appendTo(u.loading.selector).show(u.loading.speed,function(){beginAjax(u)})},u.loading.finished=u.loading.finished||function(){u.loading.msg.fadeOut("normal")},u.callback=function(n,f){!u.behavior||n["_callback_"+u.behavior]===i||n["_callback_"+u.behavior].call(t(u.contentSelector)[0],f),r&&r.call(t(u.contentSelector)[0],f,u)},this._setup(),!0):!1},_debug:function(){if(this.options&&this.options.debug)return n.console&&console.log.call(console,arguments)},_determinepath:function(n){var t=this.options;if(!!t.behavior&&this["_determinepath_"+t.behavior]!==i){this["_determinepath_"+t.behavior].call(this,n);return}if(!t.pathParse)if(n.match(/^(.*?\/)2(\/$)/))n=n.match(/^(.*?\/)2(\/$)/).slice(1);else if(n.match(/^(.*?)\b2\b(.*?$)/))n=n.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(n.match(/^(.*?)2(.*?$)/)){if(n.match(/^(.*?page=)2(\/.*|$)/))return n=n.match(/^(.*?page=)2(\/.*|$)/).slice(1);n=n.match(/^(.*?)2(.*?$)/).slice(1)}else{if(n.match(/^(.*?page=)1(\/.*|$)/))return n=n.match(/^(.*?page=)1(\/.*|$)/).slice(1);this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com."),t.state.isInvalidPage=!0}else return this._debug("pathParse manual"),t.pathParse(n,this.options.state.currPage+1);return this._debug("determinePath",n),n},_error:function(n){var t=this.options;if(!!t.behavior&&this["_error_"+t.behavior]!==i){this["_error_"+t.behavior].call(this,n);return}n!=="destroy"&&n!=="end"&&(n="unknown"),this._debug("Error",n),n=="end"&&this._showdonemsg(),t.state.isDone=!0,t.state.currPage=1,t.state.isPaused=!1,this._binding("unbind")},_loadcallback:function(r,u){var f=this.options,h=this.options.callback,c=f.state.isDone?"done":f.appendCallback?"append":"no-append",e,o,s;if(!!f.behavior&&this["_loadcallback_"+f.behavior]!==i){this["_loadcallback_"+f.behavior].call(this,r,u);return}switch(c){case"done":return this._showdonemsg(),!1;case"no-append":f.dataType=="html"&&(u="<div>"+u+"</div>",u=t(u).find(f.itemSelector));break;case"append":if(o=r.children(),o.length==0)return this._error("end");for(e=document.createDocumentFragment();r[0].firstChild;)e.appendChild(r[0].firstChild);this._debug("contentSelector",t(f.contentSelector)[0]),t(f.contentSelector)[0].appendChild(e),u=o.get()}f.loading.finished.call(t(f.contentSelector)[0],f),f.animate&&(s=t(n).scrollTop()+t("#infscr-loading").height()+f.extraScrollPx+"px",t("html,body").animate({scrollTop:s},800,function(){f.state.isDuringAjax=!1})),f.animate||(f.state.isDuringAjax=!1),h(this,u)},_nearbottom:function(){var r=this.options,u=0+t(document).height()-r.binder.scrollTop()-t(n).height();return!!r.behavior&&this["_nearbottom_"+r.behavior]!==i?this["_nearbottom_"+r.behavior].call(this):(this._debug("math:",u,r.pixelsFromNavToBottom),u-r.bufferPx<r.pixelsFromNavToBottom)},_pausing:function(n){var t=this.options;if(!!t.behavior&&this["_pausing_"+t.behavior]!==i){this["_pausing_"+t.behavior].call(this,n);return}n!=="pause"&&n!=="resume"&&n!==null&&this._debug("Invalid argument. Toggling pause value instead"),n=n&&(n=="pause"||n=="resume")?n:"toggle";switch(n){case"pause":t.state.isPaused=!0;break;case"resume":t.state.isPaused=!1;break;case"toggle":t.state.isPaused=!t.state.isPaused}return this._debug("Paused",t.state.isPaused),!1},_setup:function(){var n=this.options;if(!!n.behavior&&this["_setup_"+n.behavior]!==i){this["_setup_"+n.behavior].call(this);return}return this._binding("bind"),!1},_showdonemsg:function(){var n=this.options;if(!!n.behavior&&this["_showdonemsg_"+n.behavior]!==i){this["_showdonemsg_"+n.behavior].call(this);return}n.loading.msg.find("img").hide().parent().find("div").html(n.loading.finishedMsg).animate({opacity:1},2e3,function(){t(this).parent().fadeOut("normal")}),n.errorCallback.call(t(n.contentSelector)[0],"done")},_validate:function(n){for(var i in n)if(i.indexOf&&i.indexOf("Selector")>-1&&t(n[i]).length===0)return this._debug("Your "+i+" found no elements."),!1;return!0},bind:function(){this._binding("bind")},destroy:function(){return this.options.state.isDestroyed=!0,this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(n){var r=this,u=r.options,h=u.path,f,l,s,e,o,n=n||null,c=!n?u.state.currPage:n;if(beginAjax=function(n){n.state.currPage++,r._debug("heading into ajax",h),f=t(n.contentSelector).is("table")?t("<tbody/>"):t("<div/>"),s=h.join(n.state.currPage),e=n.dataType=="html"||n.dataType=="json"?n.dataType:"html+callback",n.appendCallback&&n.dataType=="html"&&(e+="+callback");switch(e){case"html+callback":r._debug("Using HTML via .load() method"),f.load(s+" "+n.itemSelector,null,function(n){r._loadcallback(f,n)});break;case"html":r._debug("Using "+e.toUpperCase()+" via $.ajax() method"),t.ajax({url:s,dataType:n.dataType,complete:function(n,t){o=typeof n.isResolved!="undefined"?n.isResolved():t==="success"||t==="notmodified",o?r._loadcallback(f,n.responseText):r._error("end")}});break;case"json":r._debug("Using "+e.toUpperCase()+" via $.ajax() method"),t.ajax({dataType:"json",type:"GET",url:s,success:function(t,u,e){if(o=typeof e.isResolved!="undefined"?e.isResolved():u==="success"||u==="notmodified",n.appendCallback)if(n.template!=i){var s=n.template(t);f.append(s),o?r._loadcallback(f,s):r._error("end")}else r._debug("template must be defined."),r._error("end");else o?r._loadcallback(f,t):r._error("end")},error:function(){r._debug("JSON ajax request failed."),r._error("end")}})}},!!u.behavior&&this["retrieve_"+u.behavior]!==i){this["retrieve_"+u.behavior].call(this,n);return}if(u.state.isDestroyed)return this._debug("Instance is destroyed"),!1;u.state.isDuringAjax=!0,u.loading.start.call(t(u.contentSelector)[0],u)},scroll:function(){var t=this.options,n=t.state;if(!!t.behavior&&this["scroll_"+t.behavior]!==i){this["scroll_"+t.behavior].call(this);return}n.isDuringAjax||n.isInvalidPage||n.isDone||n.isDestroyed||n.isPaused||this._nearbottom()&&this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(n){t.isPlainObject(n)&&(this.options=t.extend(!0,this.options,n))}},t.fn.infinitescroll=function(n,i){var u=typeof n,r;switch(u){case"string":r=Array.prototype.slice.call(arguments,1),this.each(function(){var i=t.data(this,"infinitescroll");if(!i||!t.isFunction(i[n])||n.charAt(0)==="_")return!1;i[n].apply(i,r)});break;case"object":this.each(function(){var r=t.data(this,"infinitescroll");r?r.update(n):(r=new t.infinitescroll(n,i,this),r.failed||t.data(this,"infinitescroll",r))})}return this};var u=t.event,r;u.special.smartscroll={setup:function(){t(this).bind("scroll",u.special.smartscroll.handler)},teardown:function(){t(this).unbind("scroll",u.special.smartscroll.handler)},handler:function(n,i){var f=this,u=arguments;n.type="smartscroll",r&&clearTimeout(r),r=setTimeout(function(){t.event.handle.apply(f,u)},i==="execAsap"?0:100)}},t.fn.smartscroll=function(n){return n?this.bind("smartscroll",n):this.trigger("smartscroll",["execAsap"])}})(window,jQuery)