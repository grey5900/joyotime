{eval $page_rel='product_add';}
<div class="pageContent" id="{$page_rel}">
    <form method="post" action="{$current_url}" enctype="multipart/form-data" class="pageForm required-validate" onsubmit="return iframeCallback(this, navTabAjaxDone);">
        <div class="pageFormContent nowrap" layoutH="57">
            <dl>
                <dt>商品标题：</dt>
                <dd><input type="text" id="name" name="name" class="required" size="80" maxlength="200" value="{$product['name']}" /></dd>
            </dl>
            <dl>
                <dt>图片：</dt>
                <dd><button id="image" type="button">上传图片</button>
                (大：640x400，请传大图)
                </dd>
            </dl>
            <dl>
                <dt>商品简介：</dt>
                <dd><textarea id="description" name="description" cols="80" rows="5" class="required">{$product['description']}</textarea></dd>
            </dl>
            <dl>
                <dt>更多详情：</dt>
                <dd><textarea id="introduce" name="introduce" cols="100" rows="20" {$editor_image} class="editor">{$product['introduce']}</textarea></dd>
            </dl>
            <dl>
                <dt>适用商家：</dt>
                <dd><!--{template block/place_select}--></dd>
            </dl>
            <dl>
            	<dt>使用提示：</dt>
            	<dd><textarea id="notice" name="notice" cols="80" rows="5">{$product['notice']}</textarea></dd>
            </dl>
            <dl>
            	<dt>电子码：</dt>
            	<dd>
            		<label><input type="radio" value="0" name="tradeCodeType"{echo $product['tradeCodeType']?((empty($product)||$product['status']==1)?'':' disabled="disabled"'):' checked="checked"';}>自动生成</label>
            		<label><input type="radio" value="1" name="tradeCodeType"{echo empty($product['tradeCodeType'])?((empty($product)||$product['status']==1)?'':' disabled="disabled"'):' checked="checked"';}>手动导入</label>
            		<div id="auto_code_div" style="display:none;">
            		选择导入文件：<input type="file" name="code_file" />
            		<!--{if $product['status'] == 1}-->
            		<button name="clear_code" type="button">清空导入</button>
            		<!--{/if}-->
            		</div>
            	</dd>
            </dl>
            <dl>
                <dt>电子码到期时间：</dt>
                <dd><input type="text" name="expireDate" id="expireDate" value="{$product['expireDate']}" class="required date" format="yyyy-MM-dd HH:mm:ss" readonly="true"/></dd>
            </dl>
            <dl>
                <dt>开始时间：</dt>
                <dd><input type="text" name="startDate" id="startDate" value="{$product['startDate']}" class="required date" format="yyyy-MM-dd HH:mm:ss" readonly="true"/></dd>
            </dl>
            <dl>
                <dt>结束时间：</dt>
                <dd><input type="text" name="endDate" id="endDate" value="{$product['endDate']}" class="required date" format="yyyy-MM-dd HH:mm:ss" readonly="true"/></dd>
            </dl>
            <dl>
                <dt>新商品时间：</dt>
                <dd><input type="text" name="displayNewExpireDate" id="displayNewExpireDate" value="{echo $product['displayNewExpireDate']?$product['displayNewExpireDate']:gmdate('Y-m-d H:i:s', time()+3600*8+86400*3)}" class="required date" format="yyyy-MM-dd HH:mm:ss" readonly="true"/></dd>
            </dl>
            <dl>
                <dt>实际库存：</dt>
                <dd><input type="text" id="stock" name="stock" readonly="readonly" class="required number" size="10" maxlength="20" value="{echo $product['stock']?$product['stock']:0}" /></dd>
            </dl>
            <dl>
                <dt>销售库存：</dt>
                <dd><input type="text" id="quantity" name="quantity" class="required number" size="10" maxlength="20" value="{echo $product['quantity']?$product['quantity']:0}" />(必须小于或等于实际库存)</dd>
            </dl>
            <dl>
                <dt>单个设备/电话/帐号：</dt>
                <dd>
                    <input type="text" id="deviceLimitDays" name="deviceLimitDays" class="number" size="4" maxlength="10" value="{$product['deviceLimitDays']}" />
                    <span style="float: left">天，最大购买数：</span>
                    <input type="text" id="deviceLimit" name="deviceLimit" class="number" size="6" maxlength="10" value="{$product['deviceLimit']}" />
                    <span style="float: left">个</span>
                </dd>
            </dl>
            <dl>
                <dt>每单最大购买数：</dt>
                <dd><input type="text" id="maxQuantity" name="maxQuantity" class="number" size="10" maxlength="20" value="{echo $product['id']?$product['maxQuantity']:0}" />(0为不限制)</dd>
            </dl>
			<dl>
				<dt>用户等级：</dt>
				<dd><input type="text" id="permissionLevel" name="permissionLevel" class="number" size="10" maxlength="20" value="{echo $product['id']?$product['permissionLevel']:0}" />(大于或等于该等级的用户才可以购买，0未不限制)</dd>
			</dl>
            <dl>
                <dt>需要积分：</dt>
                <dd><input type="text" id="price" name="price" class="required number" size="10" maxlength="20" value="{$product['price']}" /></dd>
            </dl>
            <dl>
                <dt>市场价：</dt>
                <dd>
                    <input type="text" id="originalPrice" name="originalPrice" class="number" size="10" maxlength="20" value="{$product['originalPrice']}" />(不显示原价请留空)
                </dd>
            </dl>
            <dl>
                <dt><input type="checkbox" id="needRemark" {if $product['defaultComment']}checked='checked'{/if}>下单需要填写备注：</dt>
                <dd >                  	 
                </dd>
            </dl>
            <dl  id="needRemark_input" {if !$product['defaultComment']}style="display:none"{/if}>
                <dt>备注提示：</dt>
                <dd >
                  	 <input type="text" id="comment" name="comment"  size="50"  value="{$product['defaultComment']}" />
                </dd>
            </dl>
        </div>
        <div class="formBar">
            <ul>
                <li><div class="buttonActive"><div class="buttonContent"><button type="submit" id="btnSubmit" onclick="onsubmitSelected();">保存</button></div></div></li>
                <li><div class="button"><div class="buttonContent"><button type="button" class="close">取消</button></div></div></li>
            </ul>
        </div>
    </form>
</div>
<script type="text/javascript">
    $(function(){
        var options = "name:\"image\", id:\"image\", file_type:\"product\", api:\"3\"";
        <!--{if $product['image']}-->
            options += ", image_name: \"{$product['image']}\"";
        <!--{/if}-->
        $("#image", "#{$page_rel}").my_upload(eval("({" + options + "})"));
        
        $("input[name=tradeCodeType]", "#{$page_rel}").on("click", function(){
        	var val = $(this).val();
        	trade_code_type(val);
        });

        $("button[name=clear_code]", "#{$page_rel}").on("click", function(){
        	// 清空
        	if(confirm("您确定要清空之前导入的电子码么？")) {
        		$.getJSON("/inmall/clear_code/id/{$product['id']}", function(json){
        			alertMsg.info(json.message);
        			if(json.code == 0) {
        				// 成功，那么清空实际库存
        				$("input[name=stock]", "#{$page_rel}").val(0);
        				$("input[name=quantity]", "#{$page_rel}").val(0);
        			}
        		});
        	}
        });

        $("#needRemark").on("click change",function(){      
			if($("#needRemark").attr("checked")){
				$("#needRemark_input").css("display","block");
				$("#comment").addClass("required");
			}
			else{
				$("#needRemark_input").css("display","none");
				$("#comment").removeClass("required");
				$("#comment").val("");
			}
        });
        
        trade_code_type("{$product['tradeCodeType']}");
    });

function trade_code_type(value) {
	// 编辑手动，出现导入按钮
	if(value == 0) {
		$("#auto_code_div", "#{$page_rel}").hide();
		$("input[name=stock]", "#{$page_rel}").removeAttr('readonly');
		$("input[name=code_file]", "#{$page_rel}").val("");
	} else {
		$("#auto_code_div", "#{$page_rel}").show();
		$("input[name=stock]", "#{$page_rel}").attr('readonly', 'readonly');
	}
}
    
/**
 * 提交的时候选中所有的地点
 */
function onsubmitSelected(){
    $("#place", $("#{$page_rel}")).find("option").attr("selected", "selected");
}

</script>
