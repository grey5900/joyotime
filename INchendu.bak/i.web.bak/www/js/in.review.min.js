$(function(){$("#posts-action .praise").on("click",function(){if($.is_signin())dom=$(this),$.ajax({url:"/review_praise/",type:"post",dataType:"json",data:{id:dom.attr("data-id"),type:dom.attr("data-type")},async:!1,success:function(n){var r=n.msg;$("#messager").messager({message:r}),n.code==1&&($(".praise-num").plus(1),$("#praise-list").prepend('<li><a href="/user/'+online_id+'/" class="avatar large"><i></i><img src="'+online_avatar+'" alt=""></a><a href="/user/'+online_id+'/" class="username">'+online_name+"</a></li>"),dom.text("已赞").removeClass("praise").addClass("praised").off())}});else return!1;return!1});$("#posts-action .favorite").on("click",function(){if($.is_signin())dom=$(this),$.ajax({url:"/review_favorite/",type:"post",dataType:"json",data:{id:dom.attr("data-id"),type:dom.attr("data-type")},async:!1,success:function(n){var r=n.msg;$("#messager").messager({message:r}),n.code==1&&dom.text("已收藏").removeClass("favorite").addClass("favorited").off()}});else return!1;return!1});$("#review_post").click(function(){if($.is_signin()){var n=$(this);if($("#reply-write").is_empty())return!1;n.button("loading"),$.ajax({url:"/review_reply/",type:"post",dataType:"json",data:{pid:$("#pid").val(),content:$("#reply-write").val()},async:!1,success:function(t){var u=t.msg;$("#messager").messager({message:u}),t.code==1&&($(".reply-num").plus(1),load_reply("/review_replies",$("#pid").val(),1),$("#reply-write").val(""),n.button("reset"))}})}else return!1;return!1});$("#posts-action .reply").on("click",function(){$("#reply-write").focus()});$("#reply-write").on("focusin mousedown",function(){return $.is_signin()?!0:!1});$("#reply_list").delegate("#reply_to_form","submit",function(){if($("#reply_to_form").find("#message").is_empty())return!1;var n=$(this);return $.ajax({url:n.attr("action"),type:"post",dataType:"json",data:n.serialize(),async:!1,complete:function(){},success:function(n){var r=n.msg;$("#messager").messager({message:r}),n.code==1&&($(".reply-num").plus(1),load_reply("/review_replies",$("#reply_pid").val(),1)),$("#reply_to_form").hide()}}),!1}),$("#reply_list").delegate(".reply_to","click",function(){if($.is_signin())$(this).replyTo({rid:$(this).attr("data-rid"),pid:$(this).attr("data-pid")});else return!1;return!1}),$("#reply_list").delegate(".reply_delete","click",function(){$(this).replyDelete({uid:$(this).attr("data-uid"),message:"确定要删除这条回复吗？"})}),$("#reply-write").charCount({allowed:140,warning:10,css:"counter",counterElement:"span",cssWarning:"warning",cssExceeded:"exceeded",counterText:"还可以输入"}),$("#praise-list").css("height","auto");var n=$("#praise-list").height();$("#praise-list").css("height","106px"),$("#praise-expand").toggle(function(){$("#praise-list").animate({height:n}),$("#praise-expand").text("收起全部")},function(){$("#praise-list").animate({height:"106px"}),$("#praise-expand").text("展开全部")})})