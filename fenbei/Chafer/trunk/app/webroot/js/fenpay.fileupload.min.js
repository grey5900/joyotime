!function(a){"use strict";a.widget("fenpay.image_uploder",{options:{attachmentField:"data[AutoReplyMessageNews][image_attachment_id]",dataType:"json",uploadButton:".fileinput-button",delButton:".fileinput-del"},_create:function(){var b=this,c=a(b.options.uploadButton),d=a(b.options.delButton),e=a(".fileupload-loading");this.element.fileupload({disableImageResize:!1,maxFileSize:2e6,minFileSize:0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,dataType:b.options.dataType,done:function(e,f){a.each(f.result.files,function(e,f){var g=a("#cover-img"),h=a(".img-default");h.addClass("hide"),g.removeClass("hide").attr("src",f.url),c.hide(),b._setAttachment(f),d.removeClass("hide").attr("data-url",f.delete_url).attr("data-type",f.delete_type).on("click",function(){var e=d.attr("data-url"),f=d.attr("data-type");return e&&f?(a.ajax({dataType:"json",url:e,type:f,success:function(){h.removeClass("hide"),g.addClass("hide"),c.show(),d.addClass("hide")}}),!0):(a.messager("\u5220\u9664\u5931\u8d25\u3002"),b._cleanAttachment(),!0)})})},processstart:function(){e.removeClass("hide")},progress:function(){e.addClass("hide")},progressdone:function(){},fail:function(){a.messager("\u5982\u679c\u65e0\u6cd5\u4e0a\u4f20\u3002\u8bf7\u8bd5\u7740\u7528Firefox\u3001Chrome\u7b49\u975eIE\u6d4f\u89c8\u5668\u8bd5\u8bd5\u3002")},processfail:function(){a.messager("\u4e0a\u4f20\u5931\u8d25\u3002\u4e0a\u4f20\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc72MB\uff0c\u5fc5\u987bjpg, jpeg, png\u683c\u5f0f"),e.addClass("hide")}})},_setAttachment:function(b){a('input[name="'+this.options.attachmentField+'"]').val(b.image_attachment_id)},_cleanAttachment:function(){a('input[name="'+this.options.attachmentField+'"]').val("")},_destroy:function(){}})}(jQuery);