function signIn(){$(".modal-loading").length?($("#modal").modal(),$.ajax({url:"/web/index",dataType:"html",success:function(a){$("#modal").html(a)}})):$("#modal").modal()}function checkUser(){"undefined"==typeof online_id||null===online_id||0===online_id||""===online_id?$(".header .sign_in").hide():$(".header .sign_in").show().siblings().hide()}window.onerror=function(){return!0},$(function(){current_url.indexOf("/search")>=0&&$(".search_bar").remove(),$(".carousel-indicators li").bind("mouseenter",function(){var a=$(this);$(".carousel").carousel(a.index())}),$('a[data-rel="popover"]').popover(),$('[data-toggle="tooltip"],[rel="tooltip"]').tooltip(),checkUser(),$(".header .reg a").on("click",function(a){a.preventDefault(),signIn()}),$(".talent li").on("mouseenter",function(){$.browser.msie&&$.browser.version<=9?($(this).find(".img").animate({marginLeft:5},300),$(this).siblings().find(".img").animate({marginLeft:-60},300),$(this).find(".info").animate({paddingLeft:75},300),$(this).siblings().find(".info").animate({paddingLeft:10},300)):$(this).addClass("active").siblings().removeClass("active")}),$("a.qrcode").popover({placement:"left",html:!0,trigger:"hover"}),$.browser.mozilla&&$(".header,.setting").on("click",".upload",function(a){$(a.target).is("label")&&$(a.target).find('input[type="file"]').trigger("click")}),$(".header").on("click","#clt",function(a){a.preventDefault();var b=window.location.href,c=$("title").html();try{window.external.addFavorite(b,c)}catch(a){try{window.sidebar.addPanel(c,b,"")}catch(a){alert("您的浏览器不支持直接添加，请使用Ctrl+D将网址添加到收藏夹")}}}),$(document).delegate(".action-like,.action-step","click",function(a){if(a.preventDefault(),!$.checkAuth())return!1;var b=$(this),c=parseInt(b.data("sort"))||1;return b.hasClass("on")?($.messager("你已经点击过了！"),void 0):($.ajax({type:"POST",url:"/common/praise",data:{id:b.data("id"),uid:online_id,type:b.data("type"),sort:c},dataType:"json",cache:!1,success:function(a){if(0!=a.code)$.messager(a.msg);else{if($.messager(a.msg),b.parent().hasClass("sub_tit")){var c=b.text().slice(0,1),d=b.text().slice(2,-1),e=b.siblings("a"),f=e.text().slice(2,-1),g=e.text().slice(0,1);f=f.length?f:0,d.length||(d=0),d=parseInt(d),d++,f=parseInt(f),f--,b.text(c+"("+d+")"),e.removeClass("on").text(g+"("+f+")"),0>f&&e.text(g)}else{var h=b.find(".num"),i=h.html(),d=i?i.match(/\-?\d+/g):0;d++,h.html("("+d+")")}b.addClass("on")}}}),!1)}),$(".intro_banner").on("click","#cltLoc",function(a){if(a.preventDefault(),$.checkAuth()){var b=$(this);b.find(".collect").length&&$.ajax({url:"/common/favorite_placecoll",type:"post",data:{id:b.data("id")},dataType:"json",success:function(a){$.messager(a.msg)},error:function(){$.messager("通信失败，请检查网络")}})}}),$("#tip-post").live("submit",function(){var a=$(this),b=$("#cover"),c=$("#yText").val();return a.data("submiting")===!0?($.messager("请不要重复提交表单"),!1):(c.length>=10&&c.length<=500?(a.data("submiting",!0),$.ajax({url:a.attr("action"),type:"post",data:a.serialize(),dataType:"json",success:function(c){0==c.code?($.messager(c.msg),$("#preview").empty().hide(),b.empty(),$('<input type="file" id="upload" name="Filedata">').appendTo(b),a.data("submiting",!1),$("#yText").val("")):($.messager(c.msg),a.data("submiting",!1))},error:function(){$.messager("通信失败，请检查网络！"),a.data("submiting",!1)}})):$.messager("内容不能少于10字符大于500字符！"),!1)}),$(".upload #upload").live("change",function(){var a=$(this),b=$("#cover"),c=$("#preview");$.ajaxFileUpload({url:"/upload/upload_image",data:{uploadFile:a.attr("name")},fileElementId:"upload",dataType:"json",type:"post",success:function(a){1!=a.code?$.messager(a.msg):(b.html(""),$("<img />").attr("src",a.msg).appendTo(c),c.show(),$('<input type="hidden" id="photo" name="photo" >').val(a.msg).appendTo(b))}})}),$(".header").on("click","#preview",function(){var a=$(this),b=$("#cover");a.empty(),a.hide(),b.empty(),$('<input type="file" id="upload" name="Filedata">').appendTo(b)}),$(document).on("click",".action-follow",function(a){a.preventDefault();var b=$(this);return $.checkAuth()?(b.hasClass("disabled")||b.addClass("disabled").text(b.data("loading-text")),void 0):(b.addClass("focusing"),!1)}),$("html").on("submit",".reply-form",function(a){a.preventDefault();var b=$(this),c=b.find("input").length?b.find("input"):b.find("textarea"),d=b.find(".btn"),e=b.parent().siblings(".footbar").find(".action-reply .num"),f=c.val(),g=e.html().length?1*e.html().match(/\-?\d+/g).join(""):0;d.addClass("posting").text("发布中..."),$.ajax({url:"/common/reply",type:"post",data:{pid:b.data("pid"),id:b.data("id"),uid:b.data("uid"),content:encodeURIComponent(f),type:b.data("type")},dataType:"json",success:function(a){if(a.code>0)$.messager(a.msg);else{var h="";"reply"==b.data("type")&&(h='回复<a href="/user/'+b.data("uid")+'" target="_blank" class="name">'+b.data("user")+"</a>"),b.siblings(".reply-list").prepend('						<li>							<a href="/user/'+online_id+'" class="avatar"><img src="'+online_avatar+'"></a>							<p><a href="/user/'+online_id+'" class="name">'+online_name+"</a>"+h+"："+f+'<br/><span class="time">刚刚</span></p>						</li>						'),"reply"==b.data("type")&&(b.data("type",b.closest(".post").data("type")),b.data("user",""),b.data("id",b.closest(".post").data("id"))),d.removeClass("posting").text("发布"),c.blur().val(""),g++,e.html("("+g+")")}}})}),$.browser.msie&&$.browser.version<=7&&$(".timeline").on("click",".action-share",function(){var a=$(this),b=a.hasClass("open"),c=a.closest(".post");b?c.css("z-index",1):c.css("z-index",1e3)}),$("html").delegate(".action-share-weibo,.action-share-qq,.action-share-icd","click",function(){if(!$.checkAuth())return!1;var a=$(this),b=a.closest(".action-share"),c=$("#share-form");c.data("s",a.data("s")),c.data("type",b.data("type")),c.data("id",b.data("id")),c.find("textarea").val(a.data("content")),c.modal("show")}),$("#share-form").on("submit",function(){var a=$(this),b=a.find("input[type=submit]");return b.button("loading"),$.ajax({type:"POST",url:"/common/share",data:{id:a.data("id"),uid:online_id,s:a.data("s"),type:a.data("type"),content:a.find("textarea").val()},dataType:"json",cache:!1,success:function(c){if(4502==c.code||4506==c.code){var d=confirm("分享到微博需要你绑定你的微博账号，现在去绑定？");d&&(window.location.href="/profile/sync/")}else c.code>0?$.messager(c.msg):($.messager(c.msg),a.modal("hide"),$("#share_count_"+a.data("id")).plus(1));b.button("reset")}}),!1}),$(".message_input textarea").charCount(),$(".loc_album .img").on("click",".book",function(){var a=$(this),b=a.prev().attr("href");window.open(b)}),"placeholder"in document.createElement("input")||$("input,textarea").placeholder()});