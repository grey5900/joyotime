function signIn(){$(".modal-loading").length?($("#modal").modal(),$.ajax({url:"/web/index",dataType:"html",success:function(e){$("#modal").html(e)}})):$("#modal").modal()}function checkUser(){"undefined"==typeof online_id||null===online_id||0===online_id||""===online_id?$(".header .sign_in").hide():$(".header .sign_in").show().siblings().hide()}window.onerror=function(){return!0},$(function(){current_url.indexOf("/search")>=0&&$(".search_bar").remove(),$(".carousel-indicators li").bind("mouseenter",function(){var e=$(this);$(".carousel").carousel(e.index())}),$('a[data-rel="popover"]').popover(),$('[data-toggle="tooltip"],[rel="tooltip"]').tooltip(),checkUser(),$(".header .reg a").on("click",function(e){e.preventDefault(),signIn()}),$(".talent li").on("mouseenter",function(){$.browser.msie&&9>=$.browser.version?($(this).find(".img").animate({marginLeft:5},300),$(this).siblings().find(".img").animate({marginLeft:-60},300),$(this).find(".info").animate({paddingLeft:75},300),$(this).siblings().find(".info").animate({paddingLeft:10},300)):$(this).addClass("active").siblings().removeClass("active")}),$("a.qrcode").popover({placement:"left",html:!0,trigger:"hover"}),$.browser.mozilla&&$(".header,.setting").on("click",".upload",function(e){$(e.target).is("label")&&$(e.target).find('input[type="file"]').trigger("click")}),$(".header").on("click","#clt",function(e){e.preventDefault();var t=window.location.href,n=$("title").html();try{window.external.addFavorite(t,n)}catch(e){try{window.sidebar.addPanel(n,t,"")}catch(e){alert("您的浏览器不支持直接添加，请使用Ctrl+D将网址添加到收藏夹")}}}),$(document).delegate(".action-like,.action-step","click",function(e){if(e.preventDefault(),!$.checkAuth())return!1;var t=$(this),n=parseInt(t.data("sort"))||1;return t.hasClass("on")?($.messager("你已经点击过了！"),void 0):($.ajax({type:"POST",url:"/common/praise",data:{id:t.data("id"),uid:online_id,type:t.data("type"),sort:n},dataType:"json",cache:!1,success:function(e){if(0!=e.code)$.messager(e.msg);else{if($.messager(e.msg),t.parent().hasClass("sub_tit")){var n=t.text().slice(0,1),i=t.text().slice(2,-1),o=t.siblings("a"),r=o.text().slice(2,-1),s=o.text().slice(0,1);r=r.length?r:0,i.length||(i=0),i=parseInt(i),i++,r=parseInt(r),r--,t.text(n+"("+i+")"),o.removeClass("on").text(s+"("+r+")"),0>r&&o.text(s)}else{var a=t.find(".num"),l=a.html(),i=l?l.match(/\-?\d+/g):0;i++,a.html("("+i+")")}t.addClass("on")}}}),!1)}),$(".intro_banner").on("click","#cltLoc",function(e){if(e.preventDefault(),$.checkAuth()){var t=$(this);t.find(".collect").length&&$.ajax({url:"/common/favorite_placecoll",type:"post",data:{id:t.data("id")},dataType:"json",success:function(e){$.messager(e.msg)},error:function(){$.messager("通信失败，请检查网络")}})}}),$("#tip-post").live("submit",function(){var e=$(this),t=$("#cover"),n=$("#yText").val();return e.data("submiting")===!0?($.messager("请不要重复提交表单"),!1):(n.length>=10&&500>=n.length?(e.data("submiting",!0),$.ajax({url:e.attr("action"),type:"post",data:e.serialize(),dataType:"json",success:function(n){0==n.code?($.messager(n.msg),$("#preview").empty().hide(),t.empty(),$('<input type="file" id="upload" name="Filedata">').appendTo(t),e.data("submiting",!1),$("#yText").val("")):($.messager(n.msg),e.data("submiting",!1))},error:function(){$.messager("通信失败，请检查网络！"),e.data("submiting",!1)}})):$.messager("内容不能少于10字符大于500字符！"),!1)}),$(".upload #upload").live("change",function(){var e=$(this),t=$("#cover"),n=$("#preview");$.ajaxFileUpload({url:"/upload/upload_image",data:{uploadFile:e.attr("name")},fileElementId:"upload",dataType:"json",type:"post",success:function(e){1!=e.code?$.messager(e.msg):(t.html(""),$("<img />").attr("src",e.msg).appendTo(n),n.show(),$('<input type="hidden" id="photo" name="photo" >').val(e.msg).appendTo(t))}})}),$(".header").on("click","#preview",function(){var e=$(this),t=$("#cover");e.empty(),e.hide(),t.empty(),$('<input type="file" id="upload" name="Filedata">').appendTo(t)}),$(document).on("click",".action-follow",function(e){e.preventDefault();var t=$(this);return $.checkAuth()?(t.hasClass("disabled")||t.addClass("disabled").text(t.data("loading-text")),void 0):(t.addClass("focusing"),!1)}),$(".timeline").on("click",".action-reply",function(e){var t=$(this);if(e.preventDefault(),$.checkAuth()){var n=t.closest(".post").find(".replys");n.toggle()}}),$(".timeline").on("focusin",".reply-form",function(){var e=$(this),t=e.find("span");t.fadeIn()}),$(".timeline").on("focusout",".reply-form",function(){var e=$(this),t=e.find("span");""==e.find(".txt").val()&&t.fadeOut()}),$(".timeline").on("click",".reply-form .btn",function(){var e=$(this),t=e.prev();return e.hasClass("posting")?!1:(""==t.val()?$.messager("请填写回复内容"):e.parent("form").trigger("submit"),void 0)}),$("html").on("submit",".reply-form",function(e){e.preventDefault();var t=$(this),n=t.find("input").length?t.find("input"):t.find("textarea"),i=t.find(".btn"),o=t.parent().siblings(".footbar").find(".action-reply .num"),r=n.val(),s=o.html().length?1*o.html().match(/\-?\d+/g).join(""):0;i.addClass("posting").text("发布中..."),$.ajax({url:"/common/reply",type:"post",data:{pid:t.data("pid"),id:t.data("id"),uid:t.data("uid"),content:encodeURIComponent(r),type:t.data("type")},dataType:"json",success:function(e){if(e.code>0)$.messager(e.msg);else{var a="";"reply"==t.data("type")&&(a='回复<a href="/user/'+t.data("uid")+'" target="_blank" class="name">'+t.data("user")+"</a>"),t.siblings(".reply-list").prepend('						<li>							<a href="/user/'+online_id+'" class="avatar"><img src="'+online_avatar+'"></a>							<p><a href="/user/'+online_id+'" class="name">'+online_name+"</a>"+a+"："+r+'<br/><span class="time">刚刚</span></p>						</li>						'),"reply"==t.data("type")&&(t.data("type",t.closest(".post").data("type")),t.data("user",""),t.data("id",t.closest(".post").data("id"))),i.removeClass("posting").text("发布"),n.blur().val(""),s++,o.html("("+s+")")}}})}),$(".timeline").on("click",".action-replyto",function(){if(!$.checkAuth())return!1;var e=$(this),t=e.closest(".reply-list").prev(".reply-form"),n=t.find("input").length?t.find("input"):t.find("textarea.txt");t.data("id",e.data("id")),t.data("uid",e.data("uid")),t.data("type","reply"),t.data("user",e.data("user")),n.attr("placeholder","回复 "+e.data("user")).focus()}),$.browser.msie&&7>=$.browser.version&&$(".timeline").on("click",".action-share",function(){var e=$(this),t=e.hasClass("open"),n=e.closest(".post");t?n.css("z-index",1):n.css("z-index",1e3)}),$("html").delegate(".action-share-weibo,.action-share-qq,.action-share-icd","click",function(){if(!$.checkAuth())return!1;var e=$(this),t=e.closest(".action-share"),n=$("#share-form");n.data("s",e.data("s")),n.data("type",t.data("type")),n.data("id",t.data("id")),n.find("textarea").val(e.data("content")),n.modal("show")}),$("#share-form").on("submit",function(){var e=$(this),t=e.find("input[type=submit]");return t.button("loading"),$.ajax({type:"POST",url:"/common/share",data:{id:e.data("id"),uid:online_id,s:e.data("s"),type:e.data("type"),content:e.find("textarea").val()},dataType:"json",cache:!1,success:function(n){if(4502==n.code||4506==n.code){var i=confirm("分享到微博需要你绑定你的微博账号，现在去绑定？");i&&(window.location.href="/profile/sync/")}else n.code>0?$.messager(n.msg):($.messager(n.msg),e.modal("hide"),$("#share_count_"+e.data("id")).plus(1));t.button("reset")}}),!1}),$(".message_input textarea").charCount(),$(".loc_album .img").on("click",".book",function(){var e=$(this),t=e.prev().attr("href");window.open(t)}),"placeholder"in document.createElement("input")||$("input,textarea").placeholder()});